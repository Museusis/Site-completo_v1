<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> ArtTech - Cadastre-se</title>

  <!-- Aqui colocamos o link para o arquivo de estilização-->
  <link rel="stylesheet" href="Css/estiloCadastro.css">
  <link rel="stylesheet" href="Css/formulario-estilocadastro.css">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="shortcut icon" href="img/4188037.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet" />
  <script src="Js/funcoes.js"></script>
</head>

<body>
  <!-- Nosso cabeçalho -->
  <div class="header">
    <div class="container">
      <img class="logoNav" src="img/logo_navBar.png" />
      <ul class="navBar">
        <a href="index.html">
          <li>Home</li>
        </a>
        <li><a href="simulador_financeiro.html">Simulador Financeiro</a></li>
        <a href="ajuda.html">
          <li>Ajuda</li>
        </a>
        <a href="login.html">
          <li>Login</li>
        </a>
        <button onclick="btnCadastro()" class="btnCadastro">
          Cadastre-se
        </button>
      </ul>
    </div>
  </div>

   <!-- Começo Div alerta erro -->
   <div class="alerta_erro">
    <div class="card_erro" id="cardErro">
      <span id="mensagem_erro"></span>
    </div>
  </div>
  <!-- Fim Div alerta erro -->

  <!-- Começo do Banner -->

<div class="banner">

      <div class="container">
        <div class="caixa_formulario">
          <h1>Cadastre-se</h1>
          <div class="formulario">

            <span>Nome:</span>
            <input id="nome_input" type="nome" placeholder="Nome">

            <span>Sobrenome:</span>
            <input id="Sobrenome_input" type="nome" placeholder="Sobrenome">

            <span>Data de Nascimento:</span>
            <input id="Date_input" type="date" placeholder="Data">
           
            <span>Cpf/cnpj:</span>
            <input id="Cpf_input" type="text" placeholder="Cpf/Cnpj">

            <span>Cidade:</span>
            <input id="Cidade_input" type="text" placeholder="Cidade">

            <span>Cep:</span>
            <input id="Cep_input" type="text" placeholder="Cep">

            <span>E-mail:</span>
            <input id="email_input" type="email" placeholder="E-mail">

            <span>Senha:</span>
            <input id="senha_input" type="password" placeholder="*******">

            <span>Confirme a Senha:</span>
            <input id="Confirmasenha_input" type="password" placeholder="*******">

            <button onclick="cadastrar()">Cadastrar</button>
          </div>

          <!-- Começo Div Aguardar -->
      <div id="div_aguardar" class="loading-div">
        <img src="img/gifLoading.gif" id="loading-gif">
      </div>

      <div id="div_erros_login"></div>
      <!-- Fim Div Aguardar -->
        </div>
        <img class="imgCadastro" src="img/cadasImg.jpg">
      </div>
    </div>
  </div>

  <!-- Fim do Banner -->

  <!-- começo do footer -->
  <div class="baseboard">
    <div class="containerBase">
      <img class="logoBase" src="img/logo_base.png" />
      <ul class="contato">
        <li class="titulo">Contato</li>
        <li>(11) 98268-9775</li>
        <li>artech@solutions.com.br</li>
        <li>Rua Haddock Lobo, 595</li>
        <li>Bela Vista</li>
        <li>CEP 03912-932</li>
      </ul>
      <ul class="socialMedia">
        <li class="titulo">Fale Conosco</li>
        <li>Instagram</li>
        <li>Facebook</li>
        <li>Linkedin</li>
        <li>Whatsapp</li>
      </ul>
    </div>
  </div>

  <!-- fim do footer -->

</body>

</html>
<script>

  function cadastrar() {
    aguardar();

      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo
    var Nome = nome_input.value;
    var Sobrenome = Sobrenome_input.value;
    var dtNasc = Date_input.value;
    var CPF = Cpf_input.value;
    // var CNPJ = Cpf_input.value;
    var Cidade = Cidade_input.value;
    var CEP = Cep_input.value;
    var Email = email_input.value;
    var Senha = senha_input.value;
    var ConfirmaSenha = Confirmasenha_input.value;


    if (Nome == "" || Sobrenome == "" || dtNasc == "" || CPF == "" || Cidade == "" || CEP == "" || Email == "" || Senha == "" || ConfirmaSenha == "") {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML ="(Há campos que não foram preenchidos)";

      finalizarAguardar();
      return false;

    }else{
      setInterval(sumirMensagem, 5000);
    }

    // Validação do email para saber se tem @
    if (Email.indexOf('@') >= 0) {
      setInterval(sumirMensagem, 5000)
    } else {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML ="Email inválido! Falta @";
      finalizarAguardar();
      return false;
    }
    // Validação de senha para saber se ela tem no mínimo 7 digítos
    if (Senha.length > 6) {
      setInterval(sumirMensagem, 5000)
    } else {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML ="Senha inválida! Mínimo de 7 Digítos";
      finalizarAguardar();
      return false;
    }
    // Validação de senha para saber se elas são iguais
    if (ConfirmaSenha == Senha) {
      setInterval(sumirMensagem, 5000)
    } else {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML ="As senhas não coincidem!";
      finalizarAguardar();
      return false;
    }
    // Validação de CPF para saber se ele tem 11 caracteres o - e os 2 .
    if (CPF.length > 13) {
      setInterval(sumirMensagem, 5000)
    } else {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML = "CPF inválido! CPF é composto por 14 Caracteres, exemplo: 123.456.789-00";
      finalizarAguardar();
      return false;
    }

    // Validação de CNPJ para saber se ele possui
    // if (CNPJ.length > 17){
    //   setInterval(sumirMensagem, 7000)
    // }else{
    //   cardErro.style.display = "block"
    //   mensagem_erro.innerHTML = "CNPJ inválido! CNPJ é composto por 18 Caracteres, exemplo: 12.345.678/0001-00";
    //   finalizarAguardar();
    //   return false;
    // }

    // Validação de CEP para saber se ele possui 9 caracteres
    if (CEP.length > 8) {
      setInterval(sumirMensagem, 5000)
    } else {
      cardErro.style.display = "block";
      mensagem_erro.innerHTML = "CEP inválido!  CEP é composto por  9 Caracteres, exemplo: 01001-000";
      finalizarAguardar();
      return false;
    }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: Nome,
                sobrenomeServer: Sobrenome,
                CPFServer: CPF,
                emailServer: Email,
                dtNascServer: dtNasc,
                cidadeServer: Cidade,
                CEPServer: CEP,
                senhaServer: Senha,
                confirmaSenhaServer: ConfirmaSenha

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                setTimeout(() => {
                    window.location = "login.html";
                }, "2000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
  }

  function sumirMensagem() {
        cardErro.style.display = "none"
    }

</script>